---
import "@pagefind/default-ui/css/ui.css";
---

<div id="search" class="ml-4"></div>

<script is:inline>
    // Initialize Pagefind on page load
    window.addEventListener("DOMContentLoaded", () => {
        // Dynamic import to avoid SSR issues
        const initSearch = async () => {
            const { PagefindUI } = await import("@pagefind/default-ui");
            new PagefindUI({
                element: "#search",
                showSubResults: true,
                showImages: false,
                translations: {
                    placeholder: "Ask Steve...",
                    zero_results: "No insights found for [SEARCH_TERM].",
                },
            });
        };
        initSearch();
    });

    // Re-initialize on View Transition (navigation)
    document.addEventListener("astro:page-load", () => {
        // Cleanup existing instance if needed, though Pagefind is robust.
        // For simple implementations, checking if #search is empty is safer
        const searchDiv = document.getElementById("search");
        if (searchDiv && searchDiv.innerHTML === "") {
            const initSearch = async () => {
                const { PagefindUI } = await import("@pagefind/default-ui");
                new PagefindUI({
                    element: "#search",
                    showSubResults: true,
                    showImages: false,
                    translations: {
                        placeholder: "Ask Steve...",
                        zero_results: "No insights found for [SEARCH_TERM].",
                    },
                });
            };
            initSearch();
        }
    });
</script>

<style is:global>
    /* Customize Pagefind to match site theme */
    :root {
        --pagefind-ui-scale: 0.8;
        --pagefind-ui-primary: #3b82f6; /* slate-900 or blue-500 */
        --pagefind-ui-text: #334155; /* slate-700 */
        --pagefind-ui-background: #ffffff;
        --pagefind-ui-border: #e2e8f0; /* slate-200 */
        --pagefind-ui-tag: #f1f5f9;
        --pagefind-ui-border-width: 1px;
        --pagefind-ui-border-radius: 8px;
        --pagefind-ui-image-border-radius: 8px;
        --pagefind-ui-image-box-ratio: 3 / 2;
        --pagefind-ui-font: sans-serif;
    }

    .dark {
        --pagefind-ui-primary: #60a5fa; /* blue-400 */
        --pagefind-ui-text: #cbd5e1; /* slate-300 */
        --pagefind-ui-background: #0f172a; /* slate-950 */
        --pagefind-ui-border: #1e293b; /* slate-800 */
        --pagefind-ui-tag: #1e293b;
    }

    /* Minimalist Input */
    .pagefind-ui__search-input {
        background-color: #f8fafc !important; /* slate-50 */
        border-color: #e2e8f0 !important; /* slate-200 */
        color: #334155 !important; /* slate-700 */
    }
    :global(.dark) .pagefind-ui__search-input {
        background-color: #0f172a !important; /* slate-950 */
        border-color: #1e293b !important; /* slate-800 */
        color: #cbd5e1 !important; /* slate-300 */
    }

    /* Hide some default UI elements for cleaner look if desired */
    .pagefind-ui__result-thumb {
        display: none !important; /* Force hide text thumbs if configured off */
    }
</style>
